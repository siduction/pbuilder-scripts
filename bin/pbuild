#!/bin/bash
#
# pbuild
#
# (c) 2011-2013 Alf Gaida <agaida@siduction.org>
#
export ARCH="amd64"
export DIST="unstable"
export RELEASE="unstable"
OPTIONS="${@}"

while getopts “a:r:s:h” OPTION; do
     case ${OPTION} in
         a)
             ARCH=${OPTARG}
             export $ARCH
             OPTIONS=`echo ${OPTIONS} | sed -e "s/\-a//" -e "s/${OPTARG}//"`
             ;;
         r)
             RELEASE=${OPTARG}
             export $RELEASE
             OPTIONS=`echo ${OPTIONS} | sed -e "s/\-r//" -e "s/${OPTARG}//"`
             ;;
         h)
             #usage
             exit
             ;;
     esac
done

. /usr/share/pbuilder-scripts/set_pbuilder
export OLDGNUPGHOME=${GNUPGHOME}
export GNUPGHOME="/home/${BUILDER}/.gnupg"

echo -e "Options: ${OPTIONS}"
sudo -E pbuilder --build ${OPTIONS}

RESULT=$?
echo -e "\nBuildresult pbuild: $RESULT \n"

export GNUPGHOME=${OLDGNUPGHOME}

exit $RESULT
